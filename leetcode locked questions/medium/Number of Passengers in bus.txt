WITH BUS_CTE AS (
SELECT bus_id, arrival_time, LAG(ARRIVAL_TIME,1,0) OVER(ORDER BY ARRIVAL_TIME) AS PREV_BUS_TIME FROM BUSES)

SELECT A.BUS_ID, COUNT(DISTINCT B.PASSENGER_ID) AS passengers_cnt 
FROM BUS_CTE A
LEFT JOIN PASSENGERS B
ON B.ARRIVAL_TIME > A.PREV_BUS_TIME AND B.ARRIVAL_TIME<=A.ARRIVAL_TIME
GROUP BY 1
ORDER BY 1